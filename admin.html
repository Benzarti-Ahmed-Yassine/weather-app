<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Weather Control</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    const AdminInterface = () => {
      const [city, setCity] = useState("Paris");
      const [country, setCountry] = useState("France");
      const [time, setTime] = useState("23:36");
      const [date, setDate] = useState("2025-05-05");
      const [brightness, setBrightness] = useState(50);
      const [voiceCommand, setVoiceCommand] = useState("");
      const [temperature, setTemperature] = useState("N/A");
      const [humidity, setHumidity] = useState("N/A");

      // Fonction pour récupérer les coordonnées de la ville via OpenWeatherMap Geocoding API
      const fetchCoordinates = async (cityName) => {
        try {
          const geoResponse = await fetch(
            `http://api.openweathermap.org/geo/1.0/direct?q=${cityName}&limit=1&appid=3e765f7c433d84f679fadc89e48d5a81`
          );
          const geoData = await geoResponse.json();
          if (geoData.length > 0) {
            return { lat: geoData[0].lat, lon: geoData[0].lon, country: geoData[0].country };
          } else {
            throw new Error("Ville non trouvée");
          }
        } catch (error) {
          console.error("Erreur lors de la récupération des coordonnées:", error);
          return null;
        }
      };

      // Fonction pour récupérer les données météo via Open-Meteo
      const fetchWeather = async (lat, lon) => {
        try {
          const weatherResponse = await fetch(
            `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m&hourly=temperature_2m&timezone=auto`
          );
          const weatherData = await weatherResponse.json();
          const currentTemp = weatherData.current.temperature_2m;
          const currentHumidity = weatherData.current.relative_humidity_2m;
          setTemperature(`${Math.round(currentTemp)}°C`);
          setHumidity(`${currentHumidity}%`);
        } catch (error) {
          console.error("Erreur lors de la récupération des données météo:", error);
        }
      };

      // Charger les données météo initiales
      useEffect(() => {
        const loadWeather = async () => {
          const coords = await fetchCoordinates(city);
          if (coords) {
            setCountry(coords.country);
            await fetchWeather(coords.lat, coords.lon);
          }
        };
        loadWeather();
      }, [city]);

      // Gestion du changement de ville
      const handleCityChange = async (e) => {
        const newCity = e.target.value;
        setCity(newCity);
        const coords = await fetchCoordinates(newCity);
        if (coords) {
          setCountry(coords.country);
          await fetchWeather(coords.lat, coords.lon);
        }
      };

      // Gestion du changement de l'heure
      const handleTimeChange = (e) => {
        const newTime = e.target.value;
        setTime(newTime);
        // Simuler la mise à jour pour le client (via WebSocket ou stockage local si nécessaire)
        localStorage.setItem("weatherSettings", JSON.stringify({ time: newTime, city, country, brightness, temperature, humidity, date }));
      };

      // Gestion du changement de la date
      const handleDateChange = (e) => {
        const newDate = e.target.value;
        setDate(newDate);
        localStorage.setItem("weatherSettings", JSON.stringify({ time, city, country, brightness, temperature, humidity, date: newDate }));
      };

      // Gestion du changement de la luminosité
      const handleBrightnessChange = (e) => {
        const newBrightness = e.target.value;
        setBrightness(newBrightness);
        localStorage.setItem("weatherSettings", JSON.stringify({ time, city, country, brightness: newBrightness, temperature, humidity, date }));
      };

      // Gestion des commandes vocales
      const handleVoiceCommand = () => {
        const command = voiceCommand.toLowerCase();
        if (command.includes("increase light")) {
          const newBrightness = Math.min(100, parseInt(brightness) + 10);
          setBrightness(newBrightness);
          localStorage.setItem("weatherSettings", JSON.stringify({ time, city, country, brightness: newBrightness, temperature, humidity, date }));
        } else if (command.includes("decrease light")) {
          const newBrightness = Math.max(0, parseInt(brightness) - 10);
          setBrightness(newBrightness);
          localStorage.setItem("weatherSettings", JSON.stringify({ time, city, country, brightness: newBrightness, temperature, humidity, date }));
        } else if (command.includes("weather")) {
          alert(`Météo à ${city}, ${country}: ${temperature}, Humidité: ${humidity}`);
        } else if (command.includes("time")) {
          alert(`Heure actuelle: ${time}`);
        }
        setVoiceCommand("");
      };

      return (
        <div className="min-h-screen bg-gray-900 p-4 sm:p-6 flex flex-col items-center">
          <div className="admin-panel w-full max-w-md">
            <h2 className="text-2xl font-bold mb-4 text-white">Admin Control Panel</h2>
            <div className="mb-4">
              <label className="block mb-1 text-white">Set Time:</label>
              <input
                type="time"
                value={time}
                onChange={handleTimeChange}
                className="p-2 bg-gray-700 rounded text-white w-full"
              />
            </div>
            <div className="mb-4">
              <label className="block mb-1 text-white">Set Date:</label>
              <input
                type="date"
                value={date}
                onChange={handleDateChange}
                className="p-2 bg-gray-700 rounded text-white w-full"
              />
            </div>
            <div className="mb-4">
              <label className="block mb-1 text-white">Enter City for Weather:</label>
              <input
                type="text"
                value={city}
                onChange={handleCityChange}
                className="p-2 bg-gray-700 rounded text-white w-full"
                placeholder="e.g., Paris, New York, Tokyo"
              />
            </div>
            <div className="mb-4">
              <label className="block mb-1 text-white">Lighting Brightness: {brightness}%</label>
              <input
                type="range"
                min="0"
                max="100"
                value={brightness}
                onChange={handleBrightnessChange}
                className="w-full"
              />
            </div>
            <div className="mb-4">
              <label className="block mb-1 text-white">Voice Command:</label>
              <input
                type="text"
                value={voiceCommand}
                onChange={(e) => setVoiceCommand(e.target.value)}
                placeholder="e.g., 'increase light', 'weather', 'time'"
                className="p-2 bg-gray-700 rounded text-white w-full"
              />
              <button
                onClick={handleVoiceCommand}
                className="mt-2 p-2 bg-blue-600 rounded hover:bg-blue-700 text-white w-full"
              >
                Send Command
              </button>
            </div>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<AdminInterface />);
  </script>
</body>
</html>